{
  "hash": "95c4e1bfc75b9bfbb2d951df5b2e4b0c",
  "result": {
    "markdown": "---\ntitle: \"Chapter 7\"\nauthor: \"Robert W. Walker\"\ndate: \"2022-09-28\"\ncategories: [news]\n---\n\n\n\n\n## 7.4.2 Data exercises\n\nLoad the managers data set via the `peopleanalyticsdata` package or download it from the internet. It is a set of information of 571 managers in a sales organization and consists of the following fields:\n\n- `employee_id` for each manager\n- `performance_group` of each manager in a recent performance review: Bottom performer, Middle performer, Top performer\n- `yrs_employed`: total length of time employed in years\n- `manager_hire`: whether or not the individual was hired directly to be a manager (Y) or promoted to manager (N)\n- `test_score`: score on a test given to all managers\n- `group_size`: the number of employees in the group they are responsible for\n- `concern_flag`: whether or not the individual has been the subject of a complaint by a member of their group\n- `mobile_flag`: whether or not the individual works mobile (Y) or in the office (N)\n- `customers`: the number of customer accounts the manager is responsible for\n- `high_hours_flag`: whether or not the manager has entered unusually high hours into their timesheet in the past year\n- `transfers`: the number of transfer requests coming from the managerâ€™s group while they have been a manager\n- `reduced_schedule`: whether the manager works part time (Y) or full time (N)\n- `city`: the current office of the manager.\n\nConstruct a model to determine how the data provided may help explain the `performance_group` of a manager by following these steps:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmanagers <- read.csv(\"http://peopleanalytics-regression-book.org/data/managers.csv\")\n```\n:::\n\n\n\n1. Convert the outcome variable to an ordered factor of increasing performance.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmanagers$performance_group <- ordered(managers$performance_group, levels = c(\"Bottom\", \"Middle\", \"Top\"))\n```\n:::\n\n\n2. Convert input variables to categorical factors as appropriate.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(managers)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n employee_id        performance_group  yrs_employed   manager_hire      \n Length:571         Bottom:129        Min.   :2.000   Length:571        \n Class :character   Middle:376        1st Qu.:4.300   Class :character  \n Mode  :character   Top   : 66        Median :4.600   Mode  :character  \n                                      Mean   :4.596                     \n                                      3rd Qu.:5.000                     \n                                      Max.   :6.000                     \n   test_score      group_size    concern_flag       mobile_flag       \n Min.   :  0.0   Min.   : 5.00   Length:571         Length:571        \n 1st Qu.:182.0   1st Qu.:10.00   Class :character   Class :character  \n Median :235.0   Median :11.00   Mode  :character   Mode  :character  \n Mean   :240.2   Mean   :11.82                                        \n 3rd Qu.:295.0   3rd Qu.:13.00                                        \n Max.   :500.0   Max.   :25.00                                        \n   customers     high_hours_flag      transfers      reduced_schedule  \n Min.   :10.00   Length:571         Min.   :0.0000   Length:571        \n 1st Qu.:18.00   Class :character   1st Qu.:0.0000   Class :character  \n Median :20.00   Mode  :character   Median :0.0000   Mode  :character  \n Mean   :21.06                      Mean   :0.7968                     \n 3rd Qu.:24.00                      3rd Qu.:2.0000                     \n Max.   :40.00                      Max.   :5.0000                     \n     city          \n Length:571        \n Class :character  \n Mode  :character  \n                   \n                   \n                   \n```\n:::\n:::\n\n\n\n3. Perform any exploratory data analysis that you wish to do.\n\n*I'll stick with a summary.*\n\n4. Run a proportional odds logistic regression model against all relevant input variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MASS)\nmod.ORD <- polr(performance_group~yrs_employed+manager_hire+test_score+group_size+concern_flag+mobile_flag+customers+high_hours_flag+transfers+reduced_schedule+city, data=managers)\nsummary(mod.ORD)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\npolr(formula = performance_group ~ yrs_employed + manager_hire + \n    test_score + group_size + concern_flag + mobile_flag + customers + \n    high_hours_flag + transfers + reduced_schedule + city, data = managers)\n\nCoefficients:\n                      Value Std. Error  t value\nyrs_employed      -1.200549    0.21182 -5.66767\nmanager_hireY     -1.529848    0.49180 -3.11070\ntest_score         0.003533    0.00118  2.99463\ngroup_size         0.098344    0.03499  2.81033\nconcern_flagY     -0.094360    0.31017 -0.30422\nmobile_flagY      -0.105275    0.22208 -0.47403\ncustomers         -0.006245    0.02140 -0.29181\nhigh_hours_flagY   0.564096    0.20349  2.77214\ntransfers         -0.239006    0.08420 -2.83851\nreduced_scheduleY  0.191819    0.35987  0.53302\ncityHouston        0.024754    0.53748  0.04605\ncityNew York       0.316408    0.35429  0.89306\ncityOrlando        0.137964    0.53700  0.25692\ncitySan Francisco -0.286250    0.44627 -0.64143\ncityToronto        0.303623    0.33817  0.89784\n\nIntercepts:\n              Value   Std. Error t value\nBottom|Middle -4.8776  1.1191    -4.3584\nMiddle|Top    -1.1883  1.0947    -1.0855\n\nResidual Deviance: 901.0013 \nAIC: 935.0013 \n```\n:::\n:::\n\n\n5. Construct p-values for the coefficients and consider how to simplify the model to remove variables that do not impact the outcome.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# get coefficients (it's in matrix form)\ncoefficients <- summary(mod.ORD)$coefficients\n# calculate p-values\np_value <- (1 - pnorm(abs(coefficients[ ,\"t value\"]), 0, 1))*2\n# bind back to coefficients\n(coefficients <- cbind(coefficients, p_value))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                         Value  Std. Error     t value          p_value\nyrs_employed      -1.200549054 0.211823948 -5.66767388 0.00000001447491\nmanager_hireY     -1.529848463 0.491802054 -3.11069962 0.00186644694687\ntest_score         0.003532813 0.001179718  2.99462596 0.00274781577732\ngroup_size         0.098344428 0.034993894  2.81033111 0.00494905551015\nconcern_flagY     -0.094360424 0.310169136 -0.30422248 0.76095839840268\nmobile_flagY      -0.105275156 0.222083505 -0.47403411 0.63547558470810\ncustomers         -0.006245482 0.021402706 -0.29180805 0.77043339213884\nhigh_hours_flagY   0.564095583 0.203487608  2.77213727 0.00556895469976\ntransfers         -0.239006244 0.084201412 -2.83850637 0.00453252150893\nreduced_scheduleY  0.191819056 0.359873357  0.53301822 0.59402096782304\ncityHouston        0.024753812 0.537484942  0.04605489 0.96326649740558\ncityNew York       0.316407528 0.354294345  0.89306401 0.37182289551346\ncityOrlando        0.137964146 0.536996783  0.25691801 0.79724206568822\ncitySan Francisco -0.286249831 0.446269016 -0.64142887 0.52124408026741\ncityToronto        0.303623166 0.338172321  0.89783565 0.36927317450871\nBottom|Middle     -4.877642364 1.119127112 -4.35843463 0.00001309960345\nMiddle|Top        -1.188320988 1.094688871 -1.08553309 0.27768561844106\n```\n:::\n:::\n\n\n6. Calculate the odds ratios for your simplified model and write an interpretation of them.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod.ORD.S <- polr(performance_group~yrs_employed+manager_hire+test_score+group_size+high_hours_flag+transfers, data=managers)\nsummary(mod.ORD.S)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\npolr(formula = performance_group ~ yrs_employed + manager_hire + \n    test_score + group_size + high_hours_flag + transfers, data = managers)\n\nCoefficients:\n                    Value Std. Error t value\nyrs_employed     -1.25502   0.201131  -6.240\nmanager_hireY    -1.56948   0.480757  -3.265\ntest_score        0.00348   0.001162   2.995\ngroup_size        0.10243   0.032464   3.155\nhigh_hours_flagY  0.54965   0.190832   2.880\ntransfers        -0.24533   0.081103  -3.025\n\nIntercepts:\n              Value   Std. Error t value\nBottom|Middle -5.1835  0.9858    -5.2584\nMiddle|Top    -1.5099  0.9549    -1.5811\n\nResidual Deviance: 904.1867 \nAIC: 920.1867 \n```\n:::\n\n```{.r .cell-code}\nexp(summary(mod.ORD.S)$coefficients[,1])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    yrs_employed    manager_hireY       test_score       group_size \n      0.28507068       0.20815421       1.00348649       1.10786191 \nhigh_hours_flagY        transfers    Bottom|Middle       Middle|Top \n      1.73264719       0.78244568       0.00560822       0.22093960 \n```\n:::\n:::\n\n- For each year employed, the relative odds of a higher performance group decline by 71.5%.\n- For manager hires, the relative odds of a higher performance group decline by 79.2%.\n- For each point of test score, the relative odds of a higher performance rating increase by .34%.\n- For each increment of group size, the relative odds of a higher performance rating increase by 10.8%.\n- For those flagged with high hours, the relative odds of a higher performance rating increase by 73.3%.\n- For each transfer request, the relative odds of a higher performance rating decrease by 21.8%.\n\n7. Estimate the fit of the simplified model using a variety of metrics and perform tests to determine if the model is a good fit for the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDescTools::PseudoR2(\n  mod.ORD.S, \n  which = c(\"McFadden\", \"CoxSnell\", \"Nagelkerke\", \"AIC\")\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    McFadden     CoxSnell   Nagelkerke          AIC \n  0.07999042   0.12862163   0.15663647 920.18671319 \n```\n:::\n\n```{.r .cell-code}\ngeneralhoslem::lipsitz.test(mod.ORD.S)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tLipsitz goodness of fit test for ordinal response models\n\ndata:  formula:  performance_group ~ yrs_employed + manager_hire + test_score + formula:      group_size + high_hours_flag + transfers\nLR statistic = 9.7813, df = 9, p-value = 0.3685\n```\n:::\n\n```{.r .cell-code}\ngeneralhoslem::pulkrob.chisq(mod.ORD.S, c(\"manager_hire\",\"high_hours_flag\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPulkstenis-Robinson chi-squared test\n\ndata:  formula:  performance_group ~ yrs_employed + manager_hire + test_score + formula:      group_size + high_hours_flag + transfers\nX-squared = 21.082, df = 11, p-value = 0.03253\n```\n:::\n:::\n\n\nFor the Hosmer-Lemeshow test, the null hypothesis of a good model fit is reasonable; the Pulkstenis-Robinson test offers evidence to the contrary and suggests lack of fit.\n\n8. Construct new outcome variables and use a stratified binomial approach to determine if the proportional odds assumption holds for your simplified model. Are there any input variables for which you may be concerned that the assumption is violated? What would you consider doing in this case?\n\n*I refuse to do this for this purpose.  The proportional odds assumption is necessary for a cumulative ordered response model.  An alternative model, perhaps, but there is no such thing as a cumulative ordered regression model without it.*\n\nThat said, there is actually a large literature, mostly in epidemiology involving Stephen R. Cole about something called `data expansion` as an approach to these problems.  Here is what it would look like.\n\n\n\n```{.r .cell-code}\nmanagers$Not.Bottom <- (managers$performance_group!=\"Bottom\")\nmanagers$Top.Performers <- (managers$performance_group==\"Top\")\nmod.bin.NB <- glm(Not.Bottom~yrs_employed+manager_hire+test_score+group_size+high_hours_flag+transfers, family=binomial(link=\"logit\"), data=managers)\nmod.bin.TP <- glm(Top.Performers~yrs_employed+manager_hire+test_score+group_size+high_hours_flag+transfers, family=binomial(link=\"logit\"), data=managers)\nlibrary(stargazer)\nstargazer(mod.bin.NB,mod.bin.TP, type=\"html\")\n```\n\n\n<table style=\"text-align:center\"><tr><td colspan=\"3\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"></td><td colspan=\"2\"><em>Dependent variable:</em></td></tr>\n<tr><td></td><td colspan=\"2\" style=\"border-bottom: 1px solid black\"></td></tr>\n<tr><td style=\"text-align:left\"></td><td>Not.Bottom</td><td>Top.Performers</td></tr>\n<tr><td style=\"text-align:left\"></td><td>(1)</td><td>(2)</td></tr>\n<tr><td colspan=\"3\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">yrs_employed</td><td>-1.170<sup>***</sup></td><td>-1.226<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.235)</td><td>(0.305)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td><td></td></tr>\n<tr><td style=\"text-align:left\">manager_hireY</td><td>-1.679<sup>***</sup></td><td>-0.984</td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.512)</td><td>(0.693)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td><td></td></tr>\n<tr><td style=\"text-align:left\">test_score</td><td>0.004<sup>**</sup></td><td>0.004<sup>**</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.001)</td><td>(0.002)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td><td></td></tr>\n<tr><td style=\"text-align:left\">group_size</td><td>0.098<sup>**</sup></td><td>0.124<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.040)</td><td>(0.046)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td><td></td></tr>\n<tr><td style=\"text-align:left\">high_hours_flagY</td><td>0.332</td><td>0.888<sup>***</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.226)</td><td>(0.285)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td><td></td></tr>\n<tr><td style=\"text-align:left\">transfers</td><td>-0.225<sup>**</sup></td><td>-0.338<sup>**</sup></td></tr>\n<tr><td style=\"text-align:left\"></td><td>(0.093)</td><td>(0.142)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td><td></td></tr>\n<tr><td style=\"text-align:left\">Constant</td><td>4.875<sup>***</sup></td><td>0.900</td></tr>\n<tr><td style=\"text-align:left\"></td><td>(1.125)</td><td>(1.428)</td></tr>\n<tr><td style=\"text-align:left\"></td><td></td><td></td></tr>\n<tr><td colspan=\"3\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\">Observations</td><td>571</td><td>571</td></tr>\n<tr><td style=\"text-align:left\">Log Likelihood</td><td>-280.889</td><td>-180.851</td></tr>\n<tr><td style=\"text-align:left\">Akaike Inf. Crit.</td><td>575.777</td><td>375.702</td></tr>\n<tr><td colspan=\"3\" style=\"border-bottom: 1px solid black\"></td></tr><tr><td style=\"text-align:left\"><em>Note:</em></td><td colspan=\"2\" style=\"text-align:right\"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr>\n</table>\n\n\n\n9. Use the Brant-Wald test to support or reject the hypothesis that the proportional odds assumption holds for your simplified model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(brant)\nbrant::brant(mod.ORD.S)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n---------------------------------------------------- \nTest for\t\tX2\tdf\tprobability \n---------------------------------------------------- \nOmnibus\t\t\t4.87\t6\t0.56\nyrs_employed\t\t0.02\t1\t0.88\nmanager_hireY\t\t0.79\t1\t0.37\ntest_score\t\t0\t1\t0.95\ngroup_size\t\t0.21\t1\t0.65\nhigh_hours_flagY\t2.71\t1\t0.1\ntransfers\t\t0.51\t1\t0.47\n---------------------------------------------------- \n\nH0: Parallel Regression Assumption holds\n```\n:::\n:::\n\n**Seems fine despite the caveats above.**\n\n10. Write a full report on your model intended for an audience of people with limited knowledge of statistics.\n\n**TLDR: As the number of years employed increases, performance ratings decrease.  Those hired to be managers are less likely to be low performers though it does not well differentiate between middle and top performers.  Higher test scores are associated with better performance.  Managers of larger groups get higher performers.  Those working high hours are most likely to be top performers.  Finally, transfers are associated with lower performance ratings of the managers that they are departing; voting with one's feet is a thing.  Number of customers, city of employment, full or part time, concern flags and in office/mobile work have no obvious impact.**\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}