{
  "hash": "601ba78982f56369e04e842ee7d98377",
  "result": {
    "markdown": "---\ntitle: \"Chapter 6\"\nauthor: \"Robert W. Walker\"\ndate: \"2022-09-28\"\ncategories: [news]\n---\n\n\n\n\n## 6.5.2 Data exercises\n\nUse the same `health_insurance` data set from this chapter to answer these questions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"http://peopleanalytics-regression-book.org/data/health_insurance.csv\"\nhealth_insurance <- read.csv(url)\n```\n:::\n\n\n\n1. Complete the full stratified approach to modeling the three product choices that was started in Section 6.2. Calculate the coefficients, odds ratios and p-values in each case.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fastDummies)\nhealth_insurance <- fastDummies::dummy_cols(health_insurance, \"product\")\nB_model <- glm(\n  formula = product_B ~ age + gender + household + \n    position_level + absent, \n  data = health_insurance, \n  family = \"binomial\"\n)\n# summary\nsummary(B_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = product_B ~ age + gender + household + position_level + \n    absent, family = \"binomial\", data = health_insurance)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.3382  -0.5026  -0.1412   0.4718   2.6610  \n\nCoefficients:\n                  Estimate Std. Error z value  Pr(>|z|)    \n(Intercept)       0.459135   0.318257   1.443     0.149    \nage               0.062359   0.006525   9.557   < 2e-16 ***\ngenderMale       -2.294869   0.197119 -11.642   < 2e-16 ***\ngenderNon-binary  0.746624   1.107231   0.674     0.500    \nhousehold        -0.987292   0.060711 -16.262   < 2e-16 ***\nposition_level   -0.286715   0.072781  -3.939 0.0000817 ***\nabsent            0.008888   0.010418   0.853     0.394    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1812.59  on 1452  degrees of freedom\nResidual deviance:  989.22  on 1446  degrees of freedom\nAIC: 1003.2\n\nNumber of Fisher Scoring iterations: 6\n```\n:::\n\n```{.r .cell-code}\nexp(summary(B_model)$coefficients[,1])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     (Intercept)              age       genderMale genderNon-binary \n       1.5827043        1.0643445        0.1007746        2.1098642 \n       household   position_level           absent \n       0.3725844        0.7507259        1.0089276 \n```\n:::\n\n```{.r .cell-code}\nC_model <- glm(\n  formula = product_C ~ age + gender + household + \n    position_level + absent, \n  data = health_insurance, \n  family = \"binomial\"\n)\n# summary\nsummary(C_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = product_C ~ age + gender + household + position_level + \n    absent, family = \"binomial\", data = health_insurance)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.1755  -0.6413  -0.2498   0.5673   2.5783  \n\nCoefficients:\n                    Estimate  Std. Error z value Pr(>|z|)    \n(Intercept)      -7.93481599  0.45366891 -17.490  < 2e-16 ***\nage               0.11226048  0.00680073  16.507  < 2e-16 ***\ngenderMale        1.11641253  0.15610586   7.152 8.57e-13 ***\ngenderNon-binary -0.19990911  1.58470291  -0.126    0.900    \nhousehold         0.58450808  0.04039208  14.471  < 2e-16 ***\nposition_level   -0.03776099  0.06493862  -0.581    0.561    \nabsent           -0.00005825  0.00954273  -0.006    0.995    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1869.4  on 1452  degrees of freedom\nResidual deviance: 1179.3  on 1446  degrees of freedom\nAIC: 1193.3\n\nNumber of Fisher Scoring iterations: 5\n```\n:::\n\n```{.r .cell-code}\nexp(summary(C_model)$coefficients[,1])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     (Intercept)              age       genderMale genderNon-binary \n    0.0003580579     1.1188042519     3.0538788369     0.8188051735 \n       household   position_level           absent \n    1.7941082143     0.9629430626     0.9999417505 \n```\n:::\n:::\n\n\n\n2. Carefully write down your interpretation of the odds ratios from the previous question.\n\n*The relative odds of B increase by 6.4% for each additional year of age.  The relative odds of B decrease by almost 90% for males.  The relative odds of B increase by 110% for Non-binary subjects.  The relative odds of B decrease by 63% for each member of a household.  The relative odds of B decrease by 25% for each position level and the relative odds of B increase by just under one percent for each day absent.*\n\n*The relative odds of C increase by 11.8% for each additional year of age.  The relative odds of C increase by over 200% for males.  The relative odds of C decrease by 19% for Non-binary subjects.  The relative odds of C increase by 79% for each member of a household.  The relative odds of C decrease by 4% for each position level and the relative odds of C decrease by 0.006 percent for each day absent.*\n\n3. Run a multinomial logistic regression model on the product outcome using Product B as reference. Calculate the coefficients, ratios and p-values in each case.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(nnet)\nhealth_insurance$product <- relevel(as.factor(health_insurance$product), ref=\"B\")\nmod.MNL <- nnet::multinom(product ~ age+household+position_level+gender+absent, data=health_insurance)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# weights:  24 (14 variable)\ninitial  value 1596.283655 \niter  10 value 980.134002\niter  20 value 744.965846\nfinal  value 744.682378 \nconverged\n```\n:::\n\n```{.r .cell-code}\nsummary(mod.MNL)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nnnet::multinom(formula = product ~ age + household + position_level + \n    gender + absent, data = health_insurance)\n\nCoefficients:\n  (Intercept)         age household position_level genderMale genderNon-binary\nA    4.601226 -0.24367214 0.9677148      0.4153550   2.382584       -0.2532295\nC   -5.625154  0.02614886 1.1720732      0.2017425   2.479328       -1.5239331\n        absent\nA -0.011678127\nC -0.008413771\n\nStd. Errors:\n  (Intercept)         age  household position_level genderMale genderNon-binary\nA   0.5105615 0.015431776 0.06943100     0.08916873  0.2324285         1.226256\nC   0.5116098 0.008644891 0.07117376     0.08482208  0.2253558         2.000928\n      absent\nA 0.01298151\nC 0.01213475\n\nResidual Deviance: 1489.365 \nAIC: 1517.365 \n```\n:::\n\n```{.r .cell-code}\n# calculate z-statistics of coefficients\nz_stats <- summary(mod.MNL)$coefficients/\n  summary(mod.MNL)$standard.errors\nz_stats\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  (Intercept)        age household position_level genderMale genderNon-binary\nA    9.012089 -15.790285  13.93779        4.65808   10.25082       -0.2065062\nC  -10.995007   3.024776  16.46777        2.37842   11.00184       -0.7616133\n      absent\nA -0.8995969\nC -0.6933616\n```\n:::\n\n```{.r .cell-code}\n# convert to p-values\np_values <- (1 - pnorm(abs(z_stats)))*2\n# display p-values in transposed data frame\ndata.frame(t(p_values))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                              A           C\n(Intercept)      0.000000000000 0.000000000\nage              0.000000000000 0.002488176\nhousehold        0.000000000000 0.000000000\nposition_level   0.000003191726 0.017387008\ngenderMale       0.000000000000 0.000000000\ngenderNon-binary 0.836395524437 0.446290854\nabsent           0.368334803234 0.488082628\n```\n:::\n\n```{.r .cell-code}\nodds_ratios <- exp(summary(mod.MNL)$coefficients)\ndata.frame(t(odds_ratios))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                          A            C\n(Intercept)      99.6063487  0.003606009\nage               0.7837446  1.026493737\nhousehold         2.6319231  3.228679260\nposition_level    1.5149085  1.223532956\ngenderMale       10.8328575 11.933240577\ngenderNon-binary  0.7762897  0.217853354\nabsent            0.9883898  0.991621526\n```\n:::\n:::\n\n\n\n4. Verify that the coefficients for Product C against reference Product B matches those calculated in Section 6.3.3.\n\n*They do.*\n\n5. Carefully write down your interpretation of the odds ratios calculated in the previous question.\n\n*For each unit of age, the relative odds of A decrease by 22% and the relative odds of C increase by 2.6%.  For each member of the household, the relative odds of A increase by 163% and the relative odds of C increase by 223%.  For each unit of position level, the relative odds of A increase by 51.5% and increase for C by 22.4%.  Males have relative odds 983% higher for A and 1093% higher for C.  Non-binary has 22.4% lower relative odds for A and 78.2% lower relative odds for C.  Each day of absence decreases relative odds of A by 1.2% and C by .84%.*\n\n6. Use the process described in Section 6.4.1 to simplify the multinomial model in Question 3.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod.MNL <- nnet::multinom(product ~ age+household+position_level+gender, data=health_insurance)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# weights:  21 (12 variable)\ninitial  value 1596.283655 \niter  10 value 873.188793\niter  20 value 745.137511\nfinal  value 745.124043 \nconverged\n```\n:::\n\n```{.r .cell-code}\nsummary(mod.MNL)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nnnet::multinom(formula = product ~ age + household + position_level + \n    gender, data = health_insurance)\n\nCoefficients:\n  (Intercept)         age household position_level genderMale genderNon-binary\nA    4.500997 -0.24338609 0.9641998      0.3911706   2.377054       -0.1716652\nC   -5.691713  0.02637775 1.1692938      0.1820893   2.475113       -1.4676958\n\nStd. Errors:\n  (Intercept)         age  household position_level genderMale genderNon-binary\nA   0.4976653 0.015428446 0.06916521     0.08507585  0.2323558         1.221831\nC   0.5022372 0.008632684 0.07095526     0.07976710  0.2252566         1.993456\n\nResidual Deviance: 1490.248 \nAIC: 1514.248 \n```\n:::\n:::\n\n*Dropping `absent` is justified following this procedure as the text demonstrates.  Next would be position level or gender and neither are justified.*\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}